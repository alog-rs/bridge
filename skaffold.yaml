apiVersion: skaffold/v2beta9
kind: Config
metadata:
  name: bridge
build:
  artifacts:
    - image: registry.digitalocean.com/alog-rs/bridge
      docker:
        dockerfile: ./Dockerfile
deploy:
  helm:
    releases:
      - name: bridge-dev
        chartPath: src/bridge/alog-bridge
        valuesFiles:
          - "./alog-bridge/values.yaml"
          - "./alog-bridge/values.development.yaml"
        artifactOverrides:
          image: registry.digitalocean.com/alog-rs/bridge

profiles:
  - name: bridge-prod
    activation:
      - env: PRODUCTION_ENV=1
    patches:
      - op: replace
        path: /deploy/helm/releases/0/valuesFiles
        value:
          - "./alog-bridge/values.yaml"
          - "./alog-bridge/values.production.yaml"